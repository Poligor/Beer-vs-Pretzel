<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tic‚ÄëTac‚ÄëToe ‚Ä¢ Beer vs Pretzel</title>
  <meta name="description" content="Play Beer vs Pretzel Tic‚ÄëTac‚ÄëToe. X=üç∫ Beer, O=ü•® Pretzel. Shareable, mobile‚Äëfriendly." />
  <style>
    :root{ --bg:#0f1115; --panel:#171922; --muted:#9aa3b2; --text:#e6e8ef; --accent:#7bd88f; --grid:#4b5a80; --shadow:0 10px 30px rgba(0,0,0,.35) }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 10% -10%,#1f2230 0%,transparent 50%),radial-gradient(1200px 800px at 110% 10%,#23283a 0%,transparent 52%),var(--bg);color:var(--text);font:16px/1.4 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:980px;margin:0 auto;padding:24px}

    /* Topbar */
    .topbar{width:100%;text-align:center;padding:8px 8px;border-bottom:1px solid #232739}
    .topbar .logo{display:inline-grid;place-items:center;width:84px;height:84px;margin-bottom:1px;border-radius:14px;font-size:42px}
    .topbar h1{font-size:24px;margin:8px 0 0;font-weight:700;color:var(--text)}
    @media (max-width:600px){ .topbar h1{font-size:20px} .topbar .logo{font-size:64px} }

    /* Buttons */
    button,.btn{appearance:none;border:none;background:#1d2331;border:1px solid #2a3146;color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;letter-spacing:.2px;transition:transform .06s ease,opacity .2s ease}
    button:hover{opacity:.9}
    .primary{background:linear-gradient(180deg,#2a334a,#1a2131);border-color:#3a4666}
    .accent{background:linear-gradient(180deg,#1e3a2b,#14251d);border-color:#284e3b} /* greenish */
    .accent.off{background:linear-gradient(180deg,#3a1e1e,#2a1414);border-color:#5a2a2a} /* reddish when OFF */
    .blue{background:linear-gradient(180deg,#2a334a,#1a2131);border-color:#3a4666} /* blueish */
    .beer{background:linear-gradient(180deg,#40351a,#2a2310);border-color:#5a4720}
    .pretzel{background:linear-gradient(180deg,#402028,#271219);border-color:#5a2a38}

    .header-buttons{margin:24px 0;text-align:center}
    .flex{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

    /* Panel + status */
    .panel{background:linear-gradient(190deg,#141824,#0f121a);border:1px solid #232739;border-radius:18px;box-shadow:var(--shadow)}
    .status{display:flex;align-items:center;gap:10px;padding:14px}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid #2a3146;background:#171c29;font-size:14px}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:18px;max-width:520px;margin:0 auto}
    .cell{min-width:0;min-height:0;aspect-ratio:1/1;display:grid;place-items:center;border-radius:16px;background:linear-gradient(180deg,#1a1f2b,#121620);border:2px solid var(--grid);cursor:pointer;font-size:56px;transition:transform .06s ease, box-shadow .1s ease, background .2s ease}
    .cell:active{transform:scale(.98)}
    .cell[disabled]{cursor:not-allowed;opacity:.6}
    .cell.win{background:#395bee !important; box-shadow:0 0 0 2px #395bee inset, 0 0 16px rgba(57,91,238,.4)}

    /* Toolbar under board */
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;padding:14px;border-top:1px solid #202436;justify-content:center}

    .footer{margin-top:14px;color:var(--muted);font-size:13px;text-align:center}
    .prost-btn{display:inline-block;margin-top:12px;padding:14px 32px;border-radius:999px;background:#15a0ff;color:#fff;text-decoration:none;font-weight:700;font-size:16px;letter-spacing:1px;text-transform:uppercase;box-shadow:0 3px 8px rgba(0,0,0,.25)}
    .prost-btn:hover{opacity:.9}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="logo" aria-hidden>ü•®</div>
      <h1>Beer vs Pretzel ‚Äî Tic‚ÄëTac‚ÄëToe</h1>
    </div>

    <header class="header-buttons">
      <div class="flex">
        <button id="newGame" class="primary">New game</button>
        <button id="toggleAI" class="accent">Play vs Computer: ON</button>
        <button id="computerStarts" class="blue">Computer starts</button>
      </div>
    </header>

    <section id="board" class="panel" aria-label="Game board">
      <div class="status">
        <span class="badge" id="turnBadge">Turn: <strong style="margin-left:6px">üç∫</strong></span>
        <span class="badge" id="stateBadge">State: <strong style="margin-left:6px">Playing</strong></span>
        <span style="flex:1"></span>
      </div>

      <div class="grid" role="grid" aria-label="3 by 3 tic‚Äëtac‚Äëtoe grid">
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
        <button class="cell" role="gridcell" aria-label="Empty cell"></button>
      </div>

      <div class="toolbar">
        <div class="flex">
          <span class="badge">Starter:</span>
          <button data-starter="X" class="beer">üç∫ starts</button>
          <button data-starter="O" class="pretzel">ü•® starts</button>
        </div>
        <div class="flex">
          <button id="undo">Undo</button>
          <button id="reset">Reset</button>
        </div>
      </div>
    </section>

    <p class="footer">Tip: Toggle <em>Play vs Computer</em>. When it‚Äôs ON, you can make the computer start the round with <em>Computer starts</em>. Winning line tiles highlight in blue.<br><br>
      <a href="https://www.atwix.com" target="_blank" class="prost-btn">Prost!</a></p>
  </div>

  <script>
    const X='X', O='O';
    const EMOJI={X:'üç∫', O:'ü•®'};
    const qs=new URLSearchParams(location.search);

    let board=Array(9).fill(null);
    let turn=X;
    let historyStack=[];
    let aiEnabled=true;
    let humanPlayer=X;

    const grid=document.querySelector('.grid');
    let cells=Array.from(grid.querySelectorAll('.cell'));
    const turnBadge=document.getElementById('turnBadge');
    const stateBadge=document.getElementById('stateBadge');
    const btnNew=document.getElementById('newGame');
    const btnAI=document.getElementById('toggleAI');
    const btnCS=document.getElementById('computerStarts');

    cells.forEach((btn,i)=> btn.addEventListener('click',()=>handleMove(i)));

    btnNew.addEventListener('click',()=>{ // start a fresh round with HUMAN first by default
      reset();
    });

    btnAI.addEventListener('click',()=>{
      aiEnabled=!aiEnabled;
      btnAI.textContent=`Play vs Computer: ${aiEnabled?'ON':'OFF'}`;
      btnAI.classList.toggle('off',!aiEnabled);
      btnCS.style.display=aiEnabled?'inline-block':'none';
      humanPlayer=turn;
      render();
      if(aiEnabled&&turn!==humanPlayer)maybeAIMove();
    });

    btnCS.addEventListener('click',()=>{
      if(!aiEnabled)return;
      reset();
      humanPlayer=O; // user is O, computer is X
      turn=X;
      render();
      computerMove();
    });

    document.querySelectorAll('[data-starter]').forEach(b=> b.addEventListener('click',e=>{
      const starter=e.currentTarget.getAttribute('data-starter');
      reset();
      turn=starter;
      humanPlayer=turn;
      render();
      pushURL();
      maybeAIMove();
    }));

    document.getElementById('undo').addEventListener('click',()=>{undo();maybeAIMove();});
    document.getElementById('reset').addEventListener('click',()=>{reset();maybeAIMove();});

    function handleMove(i){
      if(board[i]||winner(board)||isDraw(board))return;
      historyStack.push(board.slice());
      board[i]=turn;
      turn=turn===X?O:X;
      render();
      pushURL();
      maybeAIMove();
    }

    function maybeAIMove(){
      if(!aiEnabled)return;
      if(winner(board)||isDraw(board))return;
      if(turn===humanPlayer)return;
      setTimeout(computerMove,140);
    }

    function computerMove(){
      const idx=getAIMove(board,turn);
      if(idx==null)return;
      historyStack.push(board.slice());
      board[idx]=turn;
      turn=turn===X?O:X;
      render();
      pushURL();
    }

    function getAIMove(b,me){
      const opp=me===X?O:X;
      const emp=empties(b);
      if(!emp.length)return null;
      const MISTAKE_P=0.25;
      if(Math.random()<MISTAKE_P)return rand(emp);
      for(const i of emp){b[i]=me;if(isWin(b,me)){b[i]=null;return i;}b[i]=null;}
      for(const i of emp){b[i]=opp;if(isWin(b,opp)){b[i]=null;return i;}b[i]=null;}
      for(const i of emp){b[i]=me;if(countWinsNext(b,me)>=2){b[i]=null;return i;}b[i]=null;}
      const forks=emp.filter(i=>{b[i]=opp;const f=countWinsNext(b,opp)>=2;b[i]=null;return f;});
      if(forks.length)return forks[0];
      if(!b[4])return 4;
      for(const [c,oc] of [[0,8],[2,6]])if(b[c]===opp&&!b[oc])return oc;
      for(const i of [0,2,6,8])if(!b[i])return i;
      for(const i of [1,3,5,7])if(!b[i])return i;
      return rand(emp);
    }

    function empties(b){const a=[];for(let i=0;i<9;i++)if(!b[i])a.push(i);return a;}
    function rand(a){return a[Math.floor(Math.random()*a.length)];}
    function isWin(b,p){return [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]].some(([a,c,d])=> b[a]===p&&b[c]===p&&b[d]===p);}
    function countWinsNext(b,p){let c=0;for(let i=0;i<9;i++){if(!b[i]){b[i]=p;if(isWin(b,p))c++;b[i]=null;}}return c;}

    function undo(){
      if(!historyStack.length)return;
      board=historyStack.pop();
      const count=board.filter(Boolean).length;
      turn=(count%2===0)?X:O;
      render();
      pushURL();
    }

    function reset(){
      board=Array(9).fill(null);
      historyStack=[];
      turn=X;
      humanPlayer=X;
      render();
      pushURL();
    }

    function randomStarter(){
      turn=Math.random()<.5?X:O;
      humanPlayer=turn;
      render();
      pushURL();
    }

    function winner(b){
      const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
      for(const [a,c,d] of lines){if(b[a]&&b[a]===b[c]&&b[a]===b[d])return[b[a],[a,c,d]];}
      return null;
    }
    function isDraw(b){return!winner(b)&&b.every(x=>x);}

    function render(){
      const win=winner(board);
      const wMark=win?win[0]:null;
      const wLine=win?win[1]:[];
      const draw=isDraw(board);
      cells.forEach((cell,i)=>{
        const v=board[i];
        cell.textContent=v?EMOJI[v]:'';
        cell.setAttribute('aria-label',v?(v===X?'Beer':'Pretzel'):'Empty cell');
        cell.disabled=Boolean(wMark||draw||(aiEnabled&&turn!==humanPlayer));
        cell.classList.remove('win');
      });
      if(wLine.length){wLine.forEach(i=>cells[i].classList.add('win'));}
      turnBadge.innerHTML='Turn: <strong style="margin-left:6px">'+(turn===X?EMOJI.X:EMOJI.O)+'</strong>';
      if(wMark){stateBadge.innerHTML='State: <strong style="margin-left:6px">'+(wMark===X?'üç∫ wins!':'ü•® wins!')+'</strong>';}else if(draw){stateBadge.innerHTML='State: <strong style="margin-left:6px">Draw</strong>'; }else{stateBadge.innerHTML='State: <strong style="margin-left:6px">Playing'+(aiEnabled?' ¬∑ vs ü§ñ':'')+'</strong>';}}

    function encodeState(){return board.map(c=>c?c:'_').join('')+':'+turn;}
    function decodeState(s){const[g,t]=s.split(':');if(!g||g.length!==9)return false;const arr=g.split('').map(ch=>ch==='_'?null:(ch==='X'?X:O));if(t!==X&&t!==O)return false;board=arr;turn=t;return true;}
    function pushURL(){try{const url=new URL(location.href);url.searchParams.set('s',encodeState());if(window.history&&typeof window.history.replaceState==='function'){window.history.replaceState(null,'',url);}}catch(e){}}

    (function boot(){
      // initial UI state
      btnAI.classList.toggle('off',!aiEnabled);
      btnCS.style.display=aiEnabled?'inline-block':'none';
      const seed=qs.get('s');
      if(seed&&decodeState(seed)){
        humanPlayer=turn; // by default, human is the side to move
        render();
      } else {
        reset();
      }
    })();
  </script>
</body>
</html>
